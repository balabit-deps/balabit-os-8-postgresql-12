Description: link to wchar.c using similar hack as in src/interfaces/libpq/Makefile
Author: Marc Deslauriers <marc.deslauriers@canonical.com>
Forwarded: not-needed

--- a/src/fe_utils/Makefile
+++ b/src/fe_utils/Makefile
@@ -21,6 +21,9 @@ override CPPFLAGS := -DFRONTEND -I$(libp
 
 OBJS = mbprint.o print.o psqlscan.o simple_list.o string_utils.o conditional.o
 
+# src/backend/utils/mb
+OBJS += wchar.o
+
 all: libpgfeutils.a
 
 libpgfeutils.a: $(OBJS)
@@ -31,6 +34,16 @@ psqlscan.c: FLEXFLAGS = -Cfe -p -p
 psqlscan.c: FLEX_NO_BACKUP=yes
 psqlscan.c: FLEX_FIX_WARNING=yes
 
+# We use a few backend modules verbatim, but since we need
+# to compile with appropriate options to build a shared lib, we can't
+# use the same object files built for the backend.
+# Instead, symlink the source files in here and build our own object files.
+# When you add a file here, remember to add it in the "clean" target below.
+
+backend_src = $(top_srcdir)/src/backend
+wchar.c: % : $(backend_src)/utils/mb/%
+	rm -f $@ && $(LN_S) $< .
+
 distprep: psqlscan.c
 
 # libpgfeutils could be useful to contrib, so install it
@@ -45,6 +58,8 @@ uninstall:
 
 clean distclean:
 	rm -f libpgfeutils.a $(OBJS) lex.backup
+# Remove files we (may have) symlinked in from other places
+	rm -f wchar.c
 
 # psqlscan.c is supposed to be in the distribution tarball,
 # so do not clean it in the clean/distclean rules
